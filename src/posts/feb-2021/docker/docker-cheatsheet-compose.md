---
title: â€œDocker cheatsheet 3. Compose"
date: "2021-02-21"
thumbnail: "../images/dream-job.jpg"
---

![Docker](../images/2021/docker.png)
<br>
#Docker compose is a containers system managemnet service created by a docker-compose.yaml file.

<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><br></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size: 22px; line-height: 107%;">Docker compose is an orchestration file to manage multiple containers on the same system.</span><span style="font-size: 22px;"><span style="line-height: 107%;"> </span></span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size: 22px; line-height: 107%;">Docker compose</span><span style="font-size:21px;line-height:107%;"> lives in a file in root, called docker-compose.yaml</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">The indentation is very important is this file (in every yaml file). We let 2 blank spaces between parents and children every time.&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">// tell it the syntax version</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">version: &ldquo;3.8&rdquo;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">The version is the features allowed in docker-compose. It can be found here: <a href="https://docs.docker.com/compose/compose-file/">https://docs.docker.com/compose/compose-file/</a></span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">Use the last version; so all the available features are included, even though you might need just a few of them.</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">services:</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">// tell it which services (containers) it has to manage</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">Make sure to name correct the eventual connections inside the images, as for example the connection to mongodb (in the string url connection), which should be named as the service name here.&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; mongodb:</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; frontend:</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; backend:&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">The services are the containers docker-compose file has to manage in the docker-compose system.&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">All the services, or containers, are 2 blanks indented under the services to make clear they are children of services.&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">mongodb:</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">// tell it which image should use</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; image: &ldquo;mongo&rdquo;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">// tell it which volumes it has to use</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; volumes:&nbsp;</span></p>
<div style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'>
    <ul style="margin-bottom:0in;list-style-type: undefined;margin-left:-0.04999999999999999in;">
        <li style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="line-height:107%;color:red;font-size:21px;color:red;">data:/data/db</span></li>
    </ul>
</div>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">The data volume is named so in the container and is related to data/db path where MongoDB saves the data.</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">// tell it if there are any env variables</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; environment:&nbsp;</span></p>
<ul style="list-style-type: undefined;margin-left:-0.04999999999999999in;">
    <li><span style="line-height:107%;color:red;font-size:21px;color:red;">MONDO_INITDB_ROOT_USERNAME=&rdquo;user&rdquo;</span></li>
    <li><span style="line-height:107%;color:red;font-size:21px;color:red;">MONGO_INITDB_ROOT_PASSWORD=&rdquo;password&rdquo;</span></li>
</ul>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">// Or tell it where to look for an env files &ndash; from the root where docker-compose lives</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:.2in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">env_file:&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp; &nbsp; &nbsp; - &nbsp; ./env</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">backend:&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">&nbsp; // tell it which image to build</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; build: ./backend&nbsp;</span><span style="font-size:21px;line-height:107%;">&ndash; where backend is the path to Dockerfile for the backend image.</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">// tell it which port to expose. This is needed because the front-end is running in browser and not in a container, so it has to have access to the backend. The network docker-compose creates is not enough and React, for example, can&rsquo;t access the backend.&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">ports:</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp; &nbsp; &nbsp;- &apos;3000:80&apos;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp;volumes:&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">// named volume for logs</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp; &nbsp; &nbsp;- logs:/app/logs</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">// named volume for all the code in app</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp; &nbsp; &nbsp;- ./backend:/app</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">// anonymous volume for Node modules.&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp; &nbsp; &nbsp;- /app/node_modules</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp; &nbsp;env_file:&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp; &nbsp; &nbsp;- ./env/backend.env</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">// depends on other service (container) to start first.&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">&nbsp; &nbsp; <span style="color:red;">depends_on:</span></span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp; &nbsp; &nbsp;- mongodb</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">// frontend service</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp;frontend:</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">// tell it where the Dockerfile for the frontend image is</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp; &nbsp;build: ./frontend</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp; &nbsp;ports:&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp; &nbsp; &nbsp;- &apos;3000:3000&apos;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp; &nbsp;volumes:&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp; &nbsp; &nbsp;- ./frontend/src:/app/src</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">// stdin_open is the interactive mode &ndash; the app can receive user interaction</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp; &nbsp;stdin_open: true</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">// tty is the terminal creation for the interactive user interaction &ndash; React needs this!</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp; &nbsp;tty: true</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp; &nbsp;depends_on:&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp; &nbsp; &nbsp;- backend</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">// must declare here the named volumes used in services. Not the bind volumes.&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">volumes:&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp;data:</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;color:red;">&nbsp; &nbsp;logs:</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">Run the docker-compose with <span style="color:red;">docker-compose up -d&nbsp;</span>(in detached mode).</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">Tear it down with <span style="color:red;">docker-compose down</span>. Every time you stop docker-compose the -rm flag is on.&nbsp;</span></p>
<p style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;margin-left:0in;line-height:107%;font-size:15px;font-family:"Calibri",sans-serif;'><span style="font-size:21px;line-height:107%;">Here the final configuration:&nbsp;</span></p>

![Docker](../images/2021/docker-compose-yaml.png)
